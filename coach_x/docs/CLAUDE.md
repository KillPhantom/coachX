# Claude 文档编写规范

## 目标

确保文档简洁、结构化、信息密度高，使 Claude 在新对话中能够快速掌握项目上下文，无需阅读冗余信息。

---

## 核心原则

### ✅ 应该保留的内容

1. **架构信息**
   - 系统设计概览
   - 组件关系图
   - 数据流向
   - 技术栈选择

2. **接口定义**
   - API 端点和参数
   - 数据模型 Schema
   - 状态管理结构
   - 关键方法签名

3. **用户流程**
   - 核心用户场景
   - 交互流程图
   - 模式/变体说明

4. **关键决策**
   - 技术方案选择理由
   - 权衡和取舍
   - 约束条件

5. **错误处理**
   - 常见错误类型
   - 处理方式
   - 边界情况

### ❌ 应该移除的内容

1. **实施细节**
   - 逐步实施清单（45 步操作...）
   - 详细的代码片段（除非是关键接口）
   - 调试日志

2. **变更历史**
   - "2025-11-04 完成了 XXX"
   - "Phase 1-8 全部完成"
   - 进度更新日志

3. **临时信息**
   - TODO 列表
   - 开发备注
   - 待解决问题

4. **冗余说明**
   - 重复的概念解释
   - 过度详细的步骤说明
   - 显而易见的内容

---

## 文档结构标准

### 推荐的章节顺序

```markdown
# 功能/模块名称

## 功能概述
[1-2 段简洁描述]

## 用户流程 / 核心场景
[流程图 + 简要说明]

## 技术架构
### 技术栈
### 组件结构
### 状态管理（如适用）

## API / 数据接口
### 请求格式
### 响应格式
### 数据模型

## 数据流
[从用户操作到数据存储的完整路径]

## 错误处理
[表格形式：错误类型 | 处理方式]

## 相关文档
[链接到其他相关文档]

---
**最后更新**: YYYY-MM-DD
```

---

## 格式规范

### 1. 流程图

**推荐**：使用文本 ASCII 流程图
```
用户操作
  ↓
前端处理
  ↓
API 调用
  ↓
后端逻辑
  ↓
数据存储
```

**对比表**：使用 Markdown 表格
```markdown
| 场景 | 行为A | 行为B | 结果 |
|------|-------|-------|------|
| ... | ... | ... | ... |
```

### 2. 代码块

**只保留关键接口定义**，不保留完整实现：

```dart
// ✅ 保留
class FooState {
  final bool isLoading;
  final String? error;
  final Data? data;
}

// ❌ 不保留完整实现细节
void implementationDetail() {
  // 50 行实现代码...
}
```

### 3. 文件结构

**使用树状结构**，标注关键文件：
```
lib/features/foo/
├── data/
│   ├── models/
│   │   └── foo_model.dart          # 数据模型
│   └── repositories/
│       └── foo_repository.dart     # 数据访问层
└── presentation/
    ├── pages/
    │   └── foo_page.dart           # 主页面
    └── providers/
        └── foo_notifier.dart       # 状态管理
```

---

## 信息密度指南

### 目标密度

- **功能概述**：100-200 字
- **用户流程**：5-10 步
- **架构说明**：关键组件 + 交互关系，无冗余
- **API 文档**：请求/响应示例，不超过 20 行

### 判断标准

**问自己**：如果 Claude 在新对话中只能读取这一个文档，它能：
- ✅ 理解这个功能是什么？
- ✅ 知道如何修改相关代码？
- ✅ 了解与其他模块的关系？
- ✅ 定位到具体的文件和函数？

如果答案是"是"，文档合格。如果需要查阅其他文档才能理解，说明关键信息缺失。

---

## 更新指南

### 何时更新

1. **架构变更**：组件结构、数据流发生变化
2. **接口变更**：API 参数、响应格式改变
3. **流程变更**：用户交互流程调整
4. **重要决策**：技术方案选择或重大重构

### 如何更新

1. **版本控制**：更新文档末尾的"最后更新"日期
2. **增量更新**：只修改变化的部分，不重写整个文档
3. **移除过时内容**：删除已废弃的架构或流程说明
4. **保持简洁**：每次更新后检查是否可以进一步精简

### 不需要更新的情况

- ❌ 小的 bug 修复
- ❌ 代码重构（不影响接口）
- ❌ UI 微调
- ❌ 变量重命名

---

## 文档类型和模板

### 1. 功能文档（Feature Docs）

**文件名格式**：`{feature_name}_implementation.md`

**必含章节**：
- 功能概述
- 用户流程
- 技术架构
- API/数据接口
- 数据流

**示例**：`ai_food_nutrition_feature.md`

---

### 2. 架构文档（Architecture Docs）

**文件名格式**：`architecture_{topic}.md`

**必含章节**：
- 设计目标
- 组件划分
- 交互关系
- 关键决策

**示例**：`architecture_design.md`

---

### 3. API 文档（API Docs）

**文件名格式**：`api_{service_name}.md` 或集中在 `backend_apis_and_document_db_schemas.md`

**必含章节**：
- 端点列表
- 请求/响应格式
- 数据模型
- 错误码

---

### 4. 实施指南（Implementation Guides）

**文件名格式**：`{feature}_implementation_guide.md`

**必含章节**：
- 前置条件
- 核心步骤（高层次，不超过 10 步）
- 关键代码位置
- 测试验证

**注意**：避免变成 45 步操作清单，保持高层次抽象。

---

## 检查清单

每次更新文档后，使用此清单验证质量：

- [ ] 功能概述是否在 200 字以内？
- [ ] 是否移除了所有变更日志/进度记录？
- [ ] 是否移除了详细的实施步骤？
- [ ] 流程图是否清晰简洁？
- [ ] 代码示例是否只保留关键接口？
- [ ] 文件结构是否标注了关键文件？
- [ ] 是否包含错误处理说明？
- [ ] 是否链接到相关文档？
- [ ] "最后更新"日期是否正确？
- [ ] Claude 能否通过此文档快速理解功能？

---

## 示例对比

### ❌ 低质量文档

```markdown
# 功能实施进度

## 2025-11-04
- ✅ 完成了 Phase 1
- ✅ 完成了 Phase 2
- ✅ 完成了 Phase 3
...（省略 40 行）

## 实施清单
1. 创建文件 foo.dart
2. 添加 import
3. 定义 class
4. 实现方法 A
...（省略 45 步）

## 详细代码
```dart
// 100 行完整实现代码
```
```

**问题**：
- 进度日志无意义
- 实施清单过于详细
- 完整代码占用大量空间

---

### ✅ 高质量文档

```markdown
# 功能名称

## 功能概述
通过 AI 识别食物并估算营养成分，支持两种模式：AI 分析和手动记录。

## 用户流程
1. 拍照 → 预览
2. 选择模式（AI / 手动）
3. 输入/确认数据
4. 保存到餐次

## 技术架构
- Frontend: Flutter + Riverpod
- Backend: Python Cloud Functions
- AI: Claude Vision API

### 核心组件
- `FoodImagePreviewPage`: 预览页面
- `AIFoodScannerNotifier`: 状态管理
- `analyze_food_nutrition`: Cloud Function

## 数据流
拍照 → 上传 Storage → 调用 Cloud Function → AI 分析 → 返回结果 → 保存 Firestore

## 错误处理
| 错误 | 处理 |
|------|------|
| 权限拒绝 | 引导用户到设置 |
| 网络错误 | 允许重试 |

---
**最后更新**: 2025-11-16
```

**优点**：
- 简洁清晰
- 关键信息完整
- 易于快速理解
- 无冗余内容

---

## 总结

**文档的价值 = 信息密度 × 可读性**

记住：
- 📝 **保留架构和接口**，移除实施细节
- 🗑️ **删除变更日志**，专注当前状态
- 📊 **使用图表和表格**，减少文字描述
- 🎯 **目标读者是未来的 Claude**，不是人类开发者

---

**最后更新**: 2025-11-16
