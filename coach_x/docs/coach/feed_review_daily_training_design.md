# Training Feed Page - Design Document

**Feature**: æ²‰æµ¸å¼è®­ç»ƒæ‰¹é˜…æµï¼ˆImmersive Training Review Feedï¼‰
**Version**: 1.0
**Date**: 2025-11-17
**Status**: Design Phase

---

## ä¸€ã€è®¾è®¡ç†å¿µï¼ˆDesign Philosophyï¼‰

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

**ä»"ä¿¡æ¯é™ˆåˆ—é¡µ"åˆ°"å¾…æ‰¹é˜…ä»»åŠ¡é˜Ÿåˆ—"**

ä¼ ç»Ÿçš„è®­ç»ƒå®¡æ ¸é¡µé¢æ˜¯ä¸€ä¸ªä¿¡æ¯é™ˆåˆ—é¡µï¼Œæ•™ç»ƒéœ€è¦åœ¨å¤æ‚çš„ç•Œé¢ä¸­å¯¼èˆªã€ç‚¹å‡»ã€æ»šåŠ¨ï¼Œæ‰èƒ½å®Œæˆæ‰¹é˜…ä»»åŠ¡ã€‚æ–°è®¾è®¡å°†é¡µé¢é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ª**"å¾…æ‰¹é˜…ä»»åŠ¡é˜Ÿåˆ—"**ï¼Œå€Ÿé‰´ TikTok/Reels çš„äº¤äº’æ¨¡å¼ï¼Œå°†æ•™ç»ƒçš„æ€ç»´æµï¼ˆ"çœ‹-åˆ¤æ–­-åé¦ˆ"ï¼‰ä¸å·¥å…·çš„äº¤äº’æµï¼ˆ"åˆ·-ä¸Šæ»‘-è¾“å…¥"ï¼‰å®Œå…¨ç»Ÿä¸€ã€‚

### 1.2 è®¾è®¡ç›®æ ‡

1. **æ²‰æµ¸å¼ä½“éªŒ**ï¼šå…¨å±å†…å®¹ï¼Œæœ€å°åŒ–å¹²æ‰°ï¼Œæ•™ç»ƒä¸“æ³¨äºè®­ç»ƒå†…å®¹æœ¬èº«
2. **æµç•…çš„æ‰¹é˜…èŠ‚å¥**ï¼š90% çš„å†…å®¹åªéœ€ä¸Šæ»‘è·³è¿‡ï¼Œ10% éœ€è¦ç•™åé¦ˆ
3. **é›¶æ‘©æ“¦åé¦ˆ**ï¼šè¾“å…¥æ¡†å§‹ç»ˆå¯è§ï¼Œç‚¹å‡»å³å¯å±•å¼€è¯„è®ºåŒº
4. **æƒ…å¢ƒä¸ä¸¢å¤±**ï¼šè¯„è®ºæ—¶è§†é¢‘ç¼©å°ä¿ç•™åœ¨é¡¶éƒ¨ï¼Œæ•™ç»ƒå¯è¾¹çœ‹è¾¹å†™

### 1.3 ç”¨æˆ·ä½“éªŒæµ

```
æ•™ç»ƒè¿›å…¥é¡µé¢
  â†“
[æ‰¹é˜…çŠ¶æ€] å…¨å±è§†é¢‘/å›¾æ–‡å¡ç‰‡ï¼Œä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢
  â”œâ”€ æ— é—®é¢˜ â†’ ä¸Šæ»‘è·³è¿‡ï¼ˆè‡ªåŠ¨æ ‡è®°å·²æ‰¹é˜…ï¼‰
  â”œâ”€ éœ€è¦åé¦ˆ â†’ ç‚¹å‡»è¾“å…¥æ¡†
  â”‚    â†“
  â”‚  [åé¦ˆçŠ¶æ€] è§†é¢‘ç¼©å°ï¼Œè¯„è®ºåŒºæ»‘å‡º
  â”‚    â”œâ”€ è¾“å…¥åé¦ˆ â†’ å‘é€ â†’ å…³é—­è¯„è®ºåŒº
  â”‚    â””â”€ å–æ¶ˆ â†’ å…³é—­è¯„è®ºåŒº
  â”‚
  â””â”€ æŸ¥çœ‹è¯¦æƒ… â†’ ç‚¹å‡»è¿›åº¦å¾½ç« 
       â†“
     [è¯¦æƒ…çŠ¶æ€] Bottom Sheet æ˜¾ç¤ºè®­ç»ƒæ€»è§ˆ
       â””â”€ å…³é—­ â†’ è¿”å›æ‰¹é˜…çŠ¶æ€
```

---

## äºŒã€æ¶æ„è®¾è®¡ï¼ˆArchitectureï¼‰

### 2.1 æ ¸å¿ƒæ¦‚å¿µæ¨¡å‹

#### Feed Itemï¼ˆFeed æµå•å…ƒï¼‰

Feed Item æ˜¯æ‰¹é˜…æµçš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ª Item ä»£è¡¨ä¸€ä¸ªéœ€è¦æ‰¹é˜…çš„å†…å®¹ã€‚

**ç±»å‹**ï¼š
- **è§†é¢‘é¡¹**ï¼šå­¦ç”Ÿä¸Šä¼ çš„è®­ç»ƒè§†é¢‘ï¼ˆæ¯ä¸ªè§†é¢‘ç‹¬ç«‹ä¸€ä¸ª Feed Itemï¼‰
- **å›¾æ–‡é¡¹**ï¼šæ— è§†é¢‘çš„ Exerciseï¼ˆæ±‡æ€»æ˜¾ç¤ºç»„æ•°ã€é‡é‡ã€æ¬¡æ•°ç­‰ï¼‰
- **å®Œæˆé¡¹**ï¼šå ä½ç¬¦ï¼Œè¡¨ç¤ºæ‰€æœ‰å†…å®¹å·²æ‰¹é˜…å®Œæˆ

**ç”Ÿæˆè§„åˆ™**ï¼š
```
DailyTraining
â”œâ”€ Exercise 1 (3 ä¸ªè§†é¢‘)
â”‚  â”œâ”€ Video 1 â†’ Feed Item 1 (è§†é¢‘é¡¹)
â”‚  â”œâ”€ Video 2 â†’ Feed Item 2 (è§†é¢‘é¡¹)
â”‚  â””â”€ Video 3 â†’ Feed Item 3 (è§†é¢‘é¡¹)
â”œâ”€ Exercise 2 (0 ä¸ªè§†é¢‘)
â”‚  â””â”€ [Summary] â†’ Feed Item 4 (å›¾æ–‡é¡¹)
â”œâ”€ Exercise 3 (1 ä¸ªè§†é¢‘)
â”‚  â””â”€ Video 1 â†’ Feed Item 5 (è§†é¢‘é¡¹)
â””â”€ [Completion] â†’ Feed Item 6 (å®Œæˆé¡¹)
```

### 2.2 ä¸‰å±‚çŠ¶æ€æœºï¼ˆState Machineï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€ä¸€ï¼šæ‰¹é˜…çŠ¶æ€ (Feed State)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å…¨å±è§†é¢‘/å›¾æ–‡å¡ç‰‡                â”‚  â”‚
â”‚  â”‚   é¡¶éƒ¨ï¼šå¯¼èˆªæ  + è¿›åº¦å¾½ç«           â”‚  â”‚
â”‚  â”‚   åº•éƒ¨ï¼šåé¦ˆè¾“å…¥æ¡†                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  æ‰‹åŠ¿ï¼šä¸Šæ»‘ â†’ ä¸‹ä¸€ä¸ª Feed Item          â”‚
â”‚  ç‚¹å‡»ï¼šè¾“å…¥æ¡† â†’ çŠ¶æ€äºŒ                  â”‚
â”‚  ç‚¹å‡»ï¼šè¿›åº¦å¾½ç«  â†’ çŠ¶æ€ä¸‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€äºŒï¼šåé¦ˆçŠ¶æ€      â”‚  â”‚ çŠ¶æ€ä¸‰ï¼šè¯¦æƒ…çŠ¶æ€      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è§†é¢‘ç¼©å° (30vh)   â”‚ â”‚  â”‚ â”‚ Bottom Sheet     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚ - æ¦‚è§ˆå¡ç‰‡       â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚ - åŠ¨ä½œåˆ—è¡¨       â”‚ â”‚
â”‚ â”‚ è¯„è®ºåŒº (70vh)     â”‚ â”‚  â”‚ â”‚ - è¥å…»æ•°æ®       â”‚ â”‚
â”‚ â”‚ - å†å²åé¦ˆ       â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚ - è¾“å…¥åŒº         â”‚ â”‚  â”‚                      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ•°æ®æµï¼ˆData Flowï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firestore: dailyTrainings/{id}                         â”‚
â”‚  - studentID: "student_123"                             â”‚
â”‚  - exercises[]: [{exerciseId, name, sets[], videos[]}]  â”‚
â”‚  - diet: {meals: [], macros: {...}}                     â”‚
â”‚  - extractedKeyFrames: {...}                            â”‚
â”‚  - isReviewed: false                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore:       â”‚    â”‚ Repository:                 â”‚
â”‚ dietPlans        â”‚    â”‚ TrainingFeedRepository      â”‚
â”‚ - studentID      â”‚â—„â”€â”€â”€â”¤ - generateFeedItems()       â”‚
â”‚ - isActive: true â”‚    â”‚ - _fetchTargetMacros()      â”‚
â”‚ - totalMacros    â”‚    â”‚ - markFeedItemReviewed()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ TrainingFeedItem (Aggregated)   â”‚
                     â”‚ - exercises[]                   â”‚
                     â”‚ - meals[]                       â”‚
                     â”‚ - actualMacros (from diet)      â”‚
                     â”‚ - targetMacros (from dietPlan)  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Provider: feedItemsProvider    â”‚
                     â”‚  - ç›‘å¬ dailyTraining å˜åŒ–       â”‚
                     â”‚  - è‡ªåŠ¨é‡æ–°ç”Ÿæˆ Feed Items       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  UI: TrainingFeedPage           â”‚
                     â”‚  - æ¸²æŸ“ Aggregated Card         â”‚
                     â”‚    - é¥®é£Ÿ Section (Macros + å›¾ç‰‡)â”‚
                     â”‚    - åŠ¨ä½œ Section (ListView)     â”‚
                     â”‚  - å¤„ç†æ‰‹åŠ¿å’Œäº¤äº’                â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ•°æ®ç»“æ„ï¼ˆData Modelsï¼‰

### 3.1 TrainingFeedItemï¼ˆæ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼‰

```dart
class TrainingFeedItem {
  final String id;                    // å”¯ä¸€æ ‡è¯†ï¼š{dailyTrainingId}_{type}_{index}
  final FeedItemType type;            // video | textCard | completion
  final String dailyTrainingId;       // å…³è”çš„è®­ç»ƒè®°å½• ID
  final String? exerciseId;           // Exercise IDï¼ˆvideo/textCard æœ‰å€¼ï¼‰
  final String? exerciseName;         // Exercise åç§°
  final bool isReviewed;              // æ˜¯å¦å·²æ‰¹é˜…
  final Map<String, dynamic>? metadata; // é¢å¤–æ•°æ®
}

enum FeedItemType {
  video,       // è§†é¢‘é¡¹
  textCard,    // å›¾æ–‡é¡¹
  completion,  // å®Œæˆå ä½ç¬¦
}
```

**metadata ç»“æ„**ï¼š

**è§†é¢‘é¡¹**ï¼š
```json
{
  "videoUrl": "https://...",
  "thumbnailUrl": "https://...",
  "videoIndex": 0,
  "duration": 120
}
```

**å›¾æ–‡é¡¹ï¼ˆå•ä¸ª Exerciseï¼‰**ï¼ˆå·²åºŸå¼ƒï¼Œä½¿ç”¨ aggregatedï¼‰ï¼š
```json
{
  "sets": [
    {"reps": 8, "weight": 100, "completed": true},
    {"reps": 8, "weight": 100, "completed": true}
  ],
  "totalSets": 5,
  "completedSets": 5,
  "avgWeight": 100,
  "totalReps": 40
}
```

**èšåˆå›¾æ–‡é¡¹ï¼ˆAggregatedï¼‰**ï¼š
```json
{
  "isAggregated": true,
  "exercises": [
    {
      "name": "æ é“ƒå§æ¨",
      "exerciseTemplateId": "ex_uuid_001",
      "sets": [
        {"reps": 8, "weight": 100, "completed": true},
        {"reps": 8, "weight": 100, "completed": true}
      ],
      "isReviewed": false
    }
  ],
  "meals": [
    {
      "name": "æ—©é¤",
      "images": ["https://...", "https://..."],
      "items": [
        {"name": "é¸¡è›‹", "amount": "2", "unit": "ä¸ª"},
        {"name": "ç‰›å¥¶", "amount": "250", "unit": "ml"}
      ]
    }
  ],
  "actualMacros": {
    "calories": 2500,
    "protein": 180,
    "carbs": 300,
    "fat": 80
  },
  "targetMacros": {
    "calories": 2800,
    "protein": 200,
    "carbs": 350,
    "fat": 90
  }
}
```

### 3.2 VideoModelï¼ˆæ ‡å‡†åŒ–è§†é¢‘æ¨¡å‹ï¼‰

```dart
class VideoModel {
  final String videoUrl;
  final String? thumbnailUrl;
  final bool isReviewed;    // NEW
  final int? duration;
}
```

**å­˜å‚¨ä½ç½®**ï¼š`dailyTrainings/{id}/exercises[i]/videos[j]`

### 3.3 TrainingFeedbackModelï¼ˆé‡æ„åï¼‰

```dart
class TrainingFeedbackModel {
  final String id;
  final String dailyTrainingId;    // å¿…å¡«
  final String studentId;
  final String coachId;
  final String trainingDate;
  final String? exerciseId;        // NEW: å¯é€‰ï¼ˆè§†é¢‘é¡¹å¡«ï¼Œå›¾æ–‡é¡¹ä¸å¡«ï¼‰
  final String? exerciseName;
  final String feedbackType;       // "text" | "voice" | "image"
  final String? textContent;
  final String? voiceUrl;
  final int? voiceDuration;
  final String? imageUrl;
  final int createdAt;
  final bool isRead;
}
```

**å…³é”®å˜æ›´**ï¼š
- âŒ ç§»é™¤ï¼š`planId`, `exerciseIndex`
- âœ… æ–°å¢ï¼š`exerciseId`ï¼ˆå¯é€‰ï¼Œç”¨äºå…³è” Exerciseï¼‰

**æŸ¥è¯¢åœºæ™¯**ï¼š

1. **è§†é¢‘é¡¹å†å²åé¦ˆ**ï¼š
   ```dart
   feedbackRepo.getExerciseHistoryFeedbacks(
     studentId: 'xxx',
     exerciseId: 'ex_uuid_123',
   );
   // æŸ¥è¯¢æ¡ä»¶ï¼šstudentId + exerciseId
   ```

2. **å›¾æ–‡é¡¹å†å²åé¦ˆ**ï¼š
   ```dart
   feedbackRepo.getDailyTrainingFeedbacks(
     dailyTrainingId: 'dt_xxx',
   );
   // æŸ¥è¯¢æ¡ä»¶ï¼šdailyTrainingId + exerciseId == null
   ```

---

## å››ã€äº¤äº’æµç¨‹ï¼ˆInteraction Flowï¼‰

### 4.1 æ‰¹é˜…çŠ¶æ€ï¼ˆFeed Stateï¼‰

#### è§†é¢‘é¡¹

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< è¿”å›] å­¦ç”Ÿå Â· ä»Šæ—¥è®­ç»ƒ [æ‰¹é˜…: 3/8]â”‚ â† é¡¶éƒ¨å å±‚ï¼ˆé¡¶éƒ¨å¯¹é½ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ é“ƒå§æ¨                        [â–¶] â”‚ â† åŠ¨ä½œä¿¡æ¯å¡ç‰‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚         [å…¨å±è§†é¢‘æ’­æ”¾]               â”‚
â”‚         ï¼ˆé¡¶éƒ¨å¯¹é½ï¼‰                 â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚                          â”Œâ”€â”€â”€â”      â”‚ â† Floating Button
â”‚                          â”‚ğŸ“¸ â”‚      â”‚    ï¼ˆä»…æš‚åœæ—¶æ˜¾ç¤ºï¼‰
â”‚                          â”‚æˆªå–â”‚      â”‚
â”‚                          â”‚å…³é”®å¸§â”‚      â”‚
â”‚                          â””â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚                     [é»‘è‰²å¡«å……åŒºåŸŸ]   â”‚ â† åº•éƒ¨é»‘è‰²å¡«å……
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     [ğŸ–¼ï¸] [ğŸ–¼ï¸]  [ğŸ–¼ï¸]                 â”‚ â† å…³é”®å¸§ç¼©ç•¥å›¾ï¼ˆ50x50ï¼‰
â”‚      |    |     |                   â”‚ â† æ—¶é—´æ ‡è®°ï¼ˆè¿æ¥è¿›åº¦æ¡ï¼‰
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  00:15 / 1:23    â”‚ â† TikTok è¿›åº¦æ¡ï¼ˆç»Ÿä¸€ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç‚¹è¯„ "æ é“ƒå§æ¨"...]         [â†’]    â”‚ â† åº•éƒ¨è¾“å…¥æ¡†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’**ï¼š
1. **è‡ªåŠ¨æ’­æ”¾**ï¼šè¿›å…¥ Feed Item æ—¶è‡ªåŠ¨æ’­æ”¾è§†é¢‘
2. **ä¸Šæ»‘**ï¼šæ ‡è®° `video.isReviewed = true`ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª Feed Item
3. **ç‚¹å‡»è¾“å…¥æ¡†**ï¼šè¿›å…¥åé¦ˆçŠ¶æ€
4. **ç‚¹å‡»è¿›åº¦å¾½ç« **ï¼šè¿›å…¥è¯¦æƒ…çŠ¶æ€
5. **ç‚¹å‡»å…³é”®å¸§ç¼©ç•¥å›¾**ï¼š
   - è§†é¢‘è·³è½¬åˆ°è¯¥æ—¶é—´ç‚¹ï¼ˆæš‚åœï¼‰
   - è‡ªåŠ¨æ‰“å¼€ `ImagePreviewPage`
6. **ç‚¹å‡» Floating Button**ï¼š
   - æ‰“å¼€ `ImagePreviewPage`ï¼ˆå…³é”®å¸§ç®¡ç†ï¼‰

#### èšåˆå›¾æ–‡é¡¹ï¼ˆAggregated Cardï¼‰

**å¸ƒå±€**ï¼ˆå…¨å±å¯æ»šåŠ¨ï¼Œé»‘è‰²èƒŒæ™¯ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Daily Summary                       â”‚ â† æ ‡é¢˜
â”‚ è®­ç»ƒä¸é¥®é£Ÿ Â· æ¯æ—¥æ±‡æ€»                 â”‚ â† å‰¯æ ‡é¢˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ é¥®é£Ÿè®°å½•                             â”‚ â† Section æ ‡é¢˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [TotalNutritionCard]            â”‚ â”‚ â† è¥å…»æ‘„å…¥å¡ç‰‡
â”‚ â”‚ å¡è·¯é‡Œ: 2500/2800 kcal          â”‚ â”‚
â”‚ â”‚ è›‹ç™½è´¨: 180/200g  [è¿›åº¦æ¡ 90%]   â”‚ â”‚
â”‚ â”‚ ç¢³æ°´:   300/350g  [è¿›åº¦æ¡ 86%]   â”‚ â”‚
â”‚ â”‚ è„‚è‚ª:   80/90g    [è¿›åº¦æ¡ 89%]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ [ğŸ–¼ï¸] [ğŸ–¼ï¸] [ğŸ–¼ï¸] [ğŸ–¼ï¸]                â”‚ â† é¤é£Ÿå›¾ç‰‡æ¨ªæ»š
â”‚                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† åˆ†éš”çº¿
â”‚                                     â”‚
â”‚ éè§†é¢‘åŠ¨ä½œ                           â”‚ â† Section æ ‡é¢˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ é“ƒå§æ¨              5/5 ç»„  âœ“ â”‚ â”‚ â† åŠ¨ä½œå¡ç‰‡
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ·±è¹²                  4/5 ç»„    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è…¿ä¸¾                  5/5 ç»„  âœ“ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ‰¹é˜…]                  [è¯¦æƒ…]      â”‚ â† æ“ä½œæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æ¥æº**ï¼š
- `actualMacros`ï¼šä» `diet.macros` è®¡ç®—ï¼ˆæ‰€æœ‰ meals ç´¯åŠ ï¼‰
- `targetMacros`ï¼šæŸ¥è¯¢ Firestore `dietPlans` collectionï¼ˆ`studentID == xxx && isActive == true`ï¼‰
- `meals`ï¼šé¥®é£Ÿè®°å½•æ•°ç»„ï¼Œæå– `images` å­—æ®µ
- `exercises`ï¼šéè§†é¢‘åŠ¨ä½œæ•°ç»„

**äº¤äº’**ï¼š
1. **ä¸Šæ»‘**ï¼šæ ‡è®°æ‰€æœ‰åŠ¨ä½œå’Œé¥®é£Ÿä¸ºå·²æ‰¹é˜…ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª Feed Item
2. **ç‚¹å‡»è¾“å…¥æ¡†**ï¼šè¿›å…¥åé¦ˆçŠ¶æ€ï¼ˆåé¦ˆä¸ç»‘å®š exerciseIdï¼‰
3. **ç‚¹å‡»é¤é£Ÿå›¾ç‰‡**ï¼šå…¨å±é¢„è§ˆå›¾ç‰‡ï¼ˆä½¿ç”¨ PhotoViewï¼‰
4. **ç‚¹å‡»è¯¦æƒ…æŒ‰é’®**ï¼šæ‰“å¼€è¯¦æƒ… Bottom Sheetï¼ˆä»…æ˜¾ç¤ºéè§†é¢‘åŠ¨ä½œè¯¦æƒ…ï¼‰

**ç©ºçŠ¶æ€å¤„ç†**ï¼š
- å¦‚æœ `meals.isEmpty && actualMacros == null`ï¼šä¸æ˜¾ç¤ºé¥®é£Ÿ Section
- å¦‚æœ `exercises.isEmpty`ï¼šä¸æ˜¾ç¤ºåŠ¨ä½œ Section
- å¦‚æœ `targetMacros == null`ï¼šä¸æ˜¾ç¤º TotalNutritionCardï¼Œä»…æ˜¾ç¤ºå›¾ç‰‡æ¨ªæ»š

#### å®Œæˆé¡¹

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< è¿”å›] å­¦ç”Ÿå Â· ä»Šæ—¥è®­ç»ƒ [æ‰¹é˜…: 8/8]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚              ğŸ‰                      â”‚
â”‚                                     â”‚
â”‚        å·²å…¨éƒ¨æ‰¹é˜…å®Œæˆï¼               â”‚
â”‚                                     â”‚
â”‚      ç‚¹å‡»è¿”å›æŸ¥çœ‹æ›´å¤šå­¦ç”Ÿ             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’**ï¼š
1. **ç‚¹å‡»ä»»æ„ä½ç½®**ï¼šè¿”å› Coach Home Page
2. **è‡ªåŠ¨è§¦å‘**ï¼š`dailyTraining.isReviewed = true`

---

### 4.2 åé¦ˆçŠ¶æ€ï¼ˆComment Stateï¼‰

#### å¸ƒå±€

**è§†é¢‘ç¼©å° + è¯„è®ºåŒºæ»‘å‡º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç¼©å°çš„è§†é¢‘ 30vh]                    â”‚ â† å¯ç‚¹å‡»å…³é—­è¯„è®ºåŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‚¹è¯„ "æ é“ƒå§æ¨"              [Ã—]    â”‚ â† å¤´éƒ¨ï¼ˆå–æ¶ˆæŒ‰é’®ï¼‰
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â† ä¸‹æ‹‰æ‰‹æŸ„
â”‚                                     â”‚
â”‚   å†å²åé¦ˆ                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ [æ•™] Coach Ivan           â”‚    â”‚
â”‚   â”‚ 2023-11-15                â”‚    â”‚
â”‚   â”‚ åŠ¨ä½œæ•´ä½“ä¸é”™ï¼æ³¨æ„ä¸‹èƒŒéƒ¨...â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ [æ•™] Coach Ivan           â”‚    â”‚
â”‚   â”‚ 2023-11-12                â”‚    â”‚
â”‚   â”‚ ä»Šå¤©çš„ä¸‹é™é€Ÿåº¦æ§åˆ¶å¾—å¾ˆå¥½...â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚   [åŠ è½½æ›´å¤š]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¾“å…¥åé¦ˆåŒº                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ [å¤šè¡Œæ–‡æœ¬æ¡†]                 â”‚  â”‚
â”‚   â”‚                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        [å‘é€]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº¤äº’é€»è¾‘

**æ‰“å¼€**ï¼š
1. ç‚¹å‡»åº•éƒ¨è¾“å…¥æ¡†
2. ä¸»è§†é¢‘å®¹å™¨ç¼©å°åˆ° 30vhï¼ˆåŠ¨ç”» 300msï¼‰
3. è¯„è®ºåŒºä»åº•éƒ¨æ»‘å‡º 70vhï¼ˆåŠ¨ç”» 400msï¼‰
4. åŠ è½½å†å²åé¦ˆï¼ˆåŸºäº `exerciseId` æˆ– `dailyTrainingId`ï¼‰

**å…³é—­**ï¼ˆ3 ç§æ–¹å¼ï¼‰ï¼š
1. **å¤´éƒ¨ä¸‹æ‹‰æ‰‹æŸ„å‘ä¸‹æ»‘åŠ¨**ï¼š
   ```dart
   GestureDetector(
     onVerticalDragEnd: (details) {
       if (details.primaryVelocity > 300) {
         closeCommentSheet();
       }
     },
   )
   ```

2. **ç‚¹å‡»å¤–éƒ¨åŒºåŸŸ**ï¼ˆé¡¶éƒ¨è§†é¢‘ç¼©ç•¥å›¾ï¼‰ï¼š
   ```dart
   GestureDetector(
     onTap: () => closeCommentSheet(),
     child: Container(height: 30vh, child: VideoThumbnail(...)),
   )
   ```

3. **ç‚¹å‡»å–æ¶ˆæŒ‰é’® [Ã—]**ï¼š
   ```dart
   CupertinoButton(
     child: Icon(CupertinoIcons.xmark),
     onPressed: () => closeCommentSheet(),
   )
   ```

**å‘é€åé¦ˆ**ï¼š
1. ç”¨æˆ·è¾“å…¥æ–‡æœ¬
2. ç‚¹å‡»"å‘é€"æŒ‰é’®
3. è°ƒç”¨ `feedbackRepo.addFeedback(...)`
4. åé¦ˆæˆåŠŸåï¼Œ**ä¸è‡ªåŠ¨å…³é—­**è¯„è®ºåŒºï¼ˆç”¨æˆ·æ‰‹åŠ¨ä¸‹æ»‘æˆ–ç‚¹å‡»å¤–éƒ¨å…³é—­ï¼‰
5. å†å²åé¦ˆåŒºè‡ªåŠ¨åˆ·æ–°ï¼ˆFirestore Streamï¼‰

---

### 4.3 è¯¦æƒ…çŠ¶æ€ï¼ˆDetail Stateï¼‰

#### å¸ƒå±€

**Bottom Sheetï¼ˆ85vhï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥è®­ç»ƒè¯¦æƒ…                    [Ã—] â”‚ â† å¤´éƒ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   éè§†é¢‘åŠ¨ä½œ                         â”‚ â† Section æ ‡é¢˜
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ æ é“ƒå§æ¨                   â”‚    â”‚ â† åŠ¨ä½œåç§°
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚    â”‚
â”‚   â”‚ 1. 100kg Ã— 8 æ¬¡  âœ“        â”‚    â”‚ â† ç»„æ•°è¯¦æƒ…
â”‚   â”‚ 2. 100kg Ã— 8 æ¬¡  âœ“        â”‚    â”‚
â”‚   â”‚ 3. 100kg Ã— 7 æ¬¡  âœ“        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ æ·±è¹²                       â”‚    â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚    â”‚
â”‚   â”‚ 1. 120kg Ã— 5 æ¬¡  âœ“        â”‚    â”‚
â”‚   â”‚ 2. 120kg Ã— 5 æ¬¡  âœ“        â”‚    â”‚
â”‚   â”‚ 3. 120kg Ã— 4 æ¬¡           â”‚    â”‚
â”‚   â”‚ 4. 110kg Ã— 5 æ¬¡  âœ“        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å˜æ›´è¯´æ˜**ï¼š
- âŒ ç§»é™¤ï¼šæ¦‚è§ˆå¡ç‰‡ï¼ˆå®Œæˆæ¦‚å†µã€æ€»ç»„æ•°ï¼‰
- âŒ ç§»é™¤ï¼šè¥å…»æ•°æ®éƒ¨åˆ†ï¼ˆå·²åœ¨ Aggregated Card ä¸­å±•ç¤ºï¼‰
- âœ… ä¿ç•™ï¼šéè§†é¢‘åŠ¨ä½œåˆ—è¡¨åŠè¯¦ç»†ç»„æ•°ä¿¡æ¯

#### æ•°æ®å±•ç¤º

**éè§†é¢‘åŠ¨ä½œè¯¦æƒ…**ï¼š
- åŠ¨ä½œåç§°ï¼š`exercise.name`
- ç»„æ•°åˆ—è¡¨ï¼š`exercise.sets[]`
  - æ¯ç»„æ˜¾ç¤ºï¼šé‡é‡ Ã— æ¬¡æ•°
  - å®ŒæˆçŠ¶æ€ï¼šâœ“ å›¾æ ‡ï¼ˆ`set.completed == true`ï¼‰

---

## äº”ã€è§†é¢‘æ’­æ”¾ä¸å…³é”®å¸§ç³»ç»Ÿï¼ˆVideo & Keyframe Systemï¼‰

### 5.1 è§†é¢‘æ’­æ”¾å™¨ï¼ˆFeedVideoPlayerï¼‰

#### ç‰¹æ€§

1. **è‡ªåŠ¨æ’­æ”¾**ï¼š
   - è¿›å…¥ Feed Item æ—¶è‡ªåŠ¨æ’­æ”¾
   - ä½¿ç”¨ `CachedVideoPlayerPlus` + `VideoCacheService`ï¼ˆ1 å°æ—¶ç¼“å­˜ï¼‰

2. **è§†é¢‘å¯¹é½**ï¼š
   - è§†é¢‘ä»é¡¶éƒ¨å¼€å§‹å¯¹é½ï¼ˆ`Alignment.topCenter`ï¼‰
   - åº•éƒ¨é»‘è‰²å¡«å……åŒºåŸŸç”¨äºæ”¾ç½®è¿›åº¦æ¡å’Œå…³é”®å¸§

3. **ç»Ÿä¸€çš„è¿›åº¦æ¡ä¸å…³é”®å¸§**ï¼š
   - ä½¿ç”¨ `TikTokProgressBar` ç»„ä»¶
   - æ”¯æŒæ‹–åŠ¨è·³è½¬ã€å…³é”®å¸§æ˜¾ç¤ºå’Œç‚¹å‡»äº¤äº’
   - å®æ—¶æ˜¾ç¤ºæ’­æ”¾æ—¶é—´ï¼ˆæ‹–åŠ¨æ—¶ï¼‰

4. **æ’­æ”¾/æš‚åœæ§åˆ¶**ï¼š
   - ç‚¹å‡»è§†é¢‘åŒºåŸŸ â†’ æš‚åœ/æ’­æ”¾
   - æš‚åœæ—¶æ˜¾ç¤º Floating Buttonï¼ˆæˆªå–å…³é”®å¸§ï¼‰

5. **é¢„åŠ è½½ä¼˜åŒ–**ï¼š
   - é¢„ä¸‹è½½å½“å‰ Â± 1 ä¸ª Feed Item çš„è§†é¢‘
   - åå°é¢„ä¸‹è½½ï¼ˆç”¨äºå…³é”®å¸§æå–ï¼‰

#### ç”Ÿå‘½å‘¨æœŸ

```dart
class FeedVideoPlayer extends StatefulWidget {
  @override
  _FeedVideoPlayerState createState() => _FeedVideoPlayerState();
}

class _FeedVideoPlayerState extends State<FeedVideoPlayer> {
  CachedVideoPlayerPlusController? _controller;
  bool _isPaused = false;
  String? _downloadedVideoPath;  // é¢„ä¸‹è½½è·¯å¾„

  @override
  void initState() {
    super.initState();
    _initializeVideo();
    _predownloadVideo();  // åå°é¢„ä¸‹è½½
  }

  @override
  void dispose() {
    _controller?.dispose();
    _cleanupDownloadedVideo();
    super.dispose();
  }
}
```

---

### 5.2 TikTok è¿›åº¦æ¡ä¸å…³é”®å¸§ç³»ç»Ÿï¼ˆTikTokProgressBarï¼‰

#### è®¾è®¡ç†å¿µ

**å…³é”®å¸§ä¸è¿›åº¦æ¡åˆå¹¶**ï¼šå°†å…³é”®å¸§æ—¶é—´è½´é›†æˆåˆ° TikTok é£æ ¼çš„è¿›åº¦æ¡ä¸­ï¼Œå®ç°ç»Ÿä¸€çš„äº¤äº’ä½“éªŒã€‚

#### ç»„ä»¶æ¶æ„

**TikTokProgressBar**ï¼šç»Ÿä¸€çš„è¿›åº¦æ¡ç»„ä»¶ï¼Œæ”¯æŒå¯é€‰çš„å…³é”®å¸§æ˜¾ç¤º

```dart
class TikTokProgressBar extends StatefulWidget {
  final VideoPlayerController controller;
  final List<KeyframeModel>? keyframes;        // å¯é€‰å…³é”®å¸§
  final ValueChanged<double>? onKeyframeTap;   // å…³é”®å¸§ç‚¹å‡»å›è°ƒ
  final ValueChanged<bool>? onDragStart;
  final ValueChanged<bool>? onDragEnd;
}
```

#### è§†è§‰å±‚æ¬¡

```
   [ğŸ–¼ï¸]   [ğŸ–¼ï¸]     [ğŸ–¼ï¸]         â† Keyframe thumbnails (50x50, positioned above)
    |      |        |           â† Time marks (2px Ã— 14px, white)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â† Progress bar (2px, unified)
```

**å¸ƒå±€ç‰¹ç‚¹**ï¼š
- è¿›åº¦æ¡é«˜åº¦ï¼šå›ºå®š 20pxï¼ˆä¸å—å…³é”®å¸§å½±å“ï¼‰
- å…³é”®å¸§æ‰©å±•é«˜åº¦ï¼š100pxï¼ˆåŒ…å«ç¼©ç•¥å›¾ + æ—¶é—´æ ‡è®°ï¼‰
- å¯¹é½æ–¹å¼ï¼šå…³é”®å¸§æ—¶é—´æ ‡è®°ç›´æ¥è¿æ¥åˆ°è¿›åº¦æ¡ï¼ˆ`bottom: 2`ï¼‰
- è¿›åº¦æ¡å¯¹é½ï¼šèƒŒæ™¯è½¨é“å’Œè¿›åº¦è½¨é“ç»Ÿä¸€ä½¿ç”¨ `Alignment.bottomLeft`

#### å…³é”®å®ç°

**ä½ç½®è®¡ç®—**ï¼š
```dart
double _calculateKeyframePosition(double timestamp, double duration, double screenWidth) {
  return (timestamp / duration) * screenWidth - 25; // å±…ä¸­ 50px ç¼©ç•¥å›¾
}
```

**äº¤äº’é€»è¾‘**ï¼š
```dart
void onKeyframeTap(double timestamp) {
  // 1. æš‚åœè§†é¢‘å¹¶è·³è½¬
  videoController.pause();
  videoController.seekTo(Duration(seconds: timestamp.toInt()));

  // 2. æ‰“å¼€å…³é”®å¸§é¢„è§ˆé¡µ
  Navigator.push(
    context,
    MaterialPageRoute(
      builder: (_) => ImagePreviewPage(
        dailyTrainingId: dailyTrainingId,
        exerciseIndex: exerciseIndex,
        keyframes: allKeyframes,
        initialTimestamp: timestamp,
        allowEditing: true,
      ),
    ),
  );
}
```

---

### 5.3 å…³é”®å¸§æµ®åŠ¨æŒ‰é’®ï¼ˆKeyframeFloatingButtonï¼‰

#### æ˜¾ç¤ºæ¡ä»¶

```dart
// ä»…åœ¨è§†é¢‘æš‚åœæ—¶æ˜¾ç¤º
if (!videoController.value.isPlaying)
  KeyframeFloatingButton(
    onTap: () => _openKeyframeManager(),
  )
```

#### æ ·å¼è§„æ ¼

```dart
Container(
  width: 60,
  height: 60,
  decoration: BoxDecoration(
    shape: BoxShape.circle,
    color: Colors.black.withOpacity(0.6),
    boxShadow: [
      BoxShadow(
        color: Colors.black.withOpacity(0.3),
        blurRadius: 8,
        offset: Offset(0, 4),
      ),
    ],
  ),
  child: Column(
    mainAxisAlignment: MainAxisAlignment.center,
    children: [
      Icon(CupertinoIcons.camera, size: 24, color: Colors.white),
      SizedBox(height: 2),
      Text(
        'æˆªå–\nå…³é”®å¸§',
        style: AppTextStyles.caption2.copyWith(
          color: Colors.white,
          height: 1.1,
        ),
        textAlign: TextAlign.center,
      ),
    ],
  ),
)
```

#### ç‚¹å‡»è¡Œä¸º

```dart
void _openKeyframeManager() {
  Navigator.push(
    context,
    MaterialPageRoute(
      builder: (_) => ImagePreviewPage(
        dailyTrainingId: dailyTrainingId,
        exerciseIndex: exerciseIndex,
        keyframes: existingKeyframes,
        allowEditing: true,
      ),
    ),
  );
}
```

---

### 5.4 å…³é”®å¸§ç®¡ç†é¡µé¢ï¼ˆImagePreviewPageï¼‰

#### åŠŸèƒ½æ‰©å±•

**æ–°å¢å‚æ•°**ï¼š
```dart
class ImagePreviewPage extends StatefulWidget {
  final String dailyTrainingId;
  final int exerciseIndex;
  final List<KeyframeModel> keyframes;      // NEW: ç°æœ‰å…³é”®å¸§åˆ—è¡¨
  final bool allowEditing;                  // NEW: æ˜¯å¦å…è®¸ç¼–è¾‘
  final double? initialTimestamp;           // NEW: åˆå§‹é«˜äº®çš„æ—¶é—´æˆ³
}
```

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å…³é—­] å…³é”®å¸§ç®¡ç†           [æ·»åŠ ]   â”‚ â† å¤´éƒ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”           â”‚
â”‚  â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚           â”‚ â† ç½‘æ ¼åˆ—è¡¨ï¼ˆ3 åˆ—ï¼‰
â”‚  â”‚0:05â”‚ â”‚0:12â”‚ â”‚0:18â”‚ â”‚0:25â”‚           â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜           â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                        â”‚
â”‚  â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚                        â”‚
â”‚  â”‚0:32â”‚ â”‚0:45â”‚                        â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                        â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’**ï¼š
1. **ç‚¹å‡»ç¼©ç•¥å›¾**ï¼šæ”¾å¤§æŸ¥çœ‹
2. **é•¿æŒ‰ç¼©ç•¥å›¾**ï¼šæ˜¾ç¤ºæ“ä½œèœå•ï¼ˆç¼–è¾‘ / åˆ é™¤ï¼‰
3. **ç‚¹å‡»"æ·»åŠ "æŒ‰é’®**ï¼š
   - è¿”å›è§†é¢‘æ’­æ”¾å™¨
   - ç”¨æˆ·è°ƒæ•´æ—¶é—´
   - ç‚¹å‡»æˆªå–æŒ‰é’®
   - å…³é”®å¸§æ·»åŠ åˆ°åˆ—è¡¨

---

### 5.5 è‡ªåŠ¨æå–é€»è¾‘ï¼ˆç¦ç”¨ï¼‰

**å†³ç­–**ï¼šå®Œå…¨ç¦ç”¨ `LocalKeyframeExtractor`

**åŸå› **ï¼š
1. æ‰‹åŠ¨æå–æ›´ç²¾å‡†ï¼ˆæ•™ç»ƒé€‰æ‹©å…³é”®æ—¶åˆ»ï¼‰
2. å‡å°‘åå°è®¡ç®—è´Ÿæ‹…
3. é¿å…å­˜å‚¨å¤§é‡æ— ç”¨å…³é”®å¸§

**ä¿ç•™æ–¹æ¡ˆ**ï¼š
- ä»£ç ä¿ç•™ï¼ˆæ³¨é‡Šæ‰ï¼‰
- æ–‡æ¡£æ ‡è®°ä¸º"æœªæ¥ AI åŠŸèƒ½"
- Firestore æ•°æ®ç»“æ„ä¿ç•™ï¼ˆæ”¯æŒ `method: "auto"` å­—æ®µï¼‰

**æœªæ¥å¯ç”¨è·¯å¾„**ï¼š
```dart
// åœ¨ FeedVideoPlayer ä¸­
// Future.delayed(Duration(seconds: 2), () {
//   if (widget.enableAutoExtraction) {
//     _autoExtractKeyframes();
//   }
// });
```

---

## å…­ã€UI/UX è§„èŒƒï¼ˆUI/UX Guidelinesï¼‰

### 6.1 é¢œè‰²ç³»ç»Ÿ

**ä¸»è‰²è°ƒ**ï¼š
- èƒŒæ™¯ï¼š`#000000`ï¼ˆçº¯é»‘ï¼Œå¼ºåŒ–è§†é¢‘æ²‰æµ¸æ„Ÿï¼‰
- æ–‡æœ¬ï¼š`#FFFFFF`ï¼ˆçº¯ç™½ï¼Œé«˜å¯¹æ¯”åº¦ï¼‰
- å å±‚èƒŒæ™¯ï¼š`rgba(0, 0, 0, 0.6)`ï¼ˆåŠé€æ˜é»‘ï¼‰
- ä¸»é¢˜è‰²ï¼š`#f2e8cf`ï¼ˆæš–ç±³è‰²ï¼Œç”¨äºæŒ‰é’®/å¾½ç« ï¼‰

**çŠ¶æ€è‰²**ï¼š
- å·²æ‰¹é˜…ï¼š`#4CAF50`ï¼ˆç»¿è‰²ï¼‰
- å¾…æ‰¹é˜…ï¼š`#FFC107`ï¼ˆé»„è‰²ï¼‰
- æ— è§†é¢‘ï¼š`#9E9E9E`ï¼ˆç°è‰²ï¼‰

### 6.2 å­—ä½“è§„èŒƒ

**ä¸¥æ ¼éµå®ˆ AppTextStyles**ï¼š

| åœºæ™¯ | æ ·å¼ | å¤§å° | æƒé‡ |
|------|------|------|------|
| å¯¼èˆªæ æ ‡é¢˜ | `navTitle` | 17px | SemiBold (600) |
| åŠ¨ä½œåç§° | `title3` | 20px | SemiBold (600) |
| è¿›åº¦å¾½ç«  | `subhead` | 15px | Regular (400) |
| è¾“å…¥æ¡†æç¤º | `callout` | 16px | Regular (400) |
| æ—¶é—´æˆ³ | `caption1` | 12px | Regular (400) |
| Floating Button æ–‡å­— | `caption2` | 11px | Regular (400) |

### 6.3 åŠ¨ç”»è§„èŒƒ

**é¡µé¢åˆ‡æ¢**ï¼š
- PageView æ»‘åŠ¨ï¼š`duration: 300ms, curve: Curves.easeInOut`

**çŠ¶æ€åˆ‡æ¢**ï¼š
- è§†é¢‘ç¼©å°ï¼ˆæ‰¹é˜… â†’ åé¦ˆï¼‰ï¼š`duration: 300ms, curve: Curves.easeInOut`
- è¯„è®ºåŒºæ»‘å‡ºï¼š`duration: 400ms, curve: Curves.easeOutCubic`
- Bottom Sheet æ»‘å‡ºï¼š`duration: 400ms, curve: Curves.easeOutCubic`

**å¾®äº¤äº’**ï¼š
- æŒ‰é’®æŒ‰ä¸‹ï¼š`Transform.scale(0.95), duration: 100ms`
- å…³é”®å¸§ç¼©ç•¥å›¾æ‚¬åœï¼š`Transform.scale(1.1), duration: 200ms`

### 6.4 æ‰‹åŠ¿è§„èŒƒ

**PageView æ»‘åŠ¨**ï¼š
- ä¸Šæ»‘ï¼šä¸‹ä¸€ä¸ª Feed Itemï¼ˆé˜ˆå€¼ï¼š50pxï¼‰
- ä¸‹æ»‘ï¼šä¸Šä¸€ä¸ª Feed Itemï¼ˆä»…ç¬¬ 2+ ä¸ª Feed Itemï¼‰

**è¯„è®ºåŒºä¸‹æ‹‰**ï¼š
- ä¸‹æ»‘é€Ÿåº¦ï¼š> 300 px/s â†’ å…³é—­è¯„è®ºåŒº
- è§¦å‘åŒºåŸŸï¼šä»…å¤´éƒ¨åŒºåŸŸï¼ˆä¸‹æ‹‰æ‰‹æŸ„ï¼‰

**è§†é¢‘æ’­æ”¾å™¨**ï¼š
- ç‚¹å‡»ï¼šæ’­æ”¾/æš‚åœ
- æ‹–åŠ¨è¿›åº¦æ¡ï¼šè·³è½¬åˆ°æŒ‡å®šä½ç½®

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–ï¼ˆPerformance Optimizationï¼‰

### 7.1 è§†é¢‘ç¼“å­˜ç­–ç•¥

**å¤ç”¨ç°æœ‰ VideoCacheService**ï¼š
- ç¼“å­˜æœ‰æ•ˆæœŸï¼š1 å°æ—¶
- å­˜å‚¨è·¯å¾„ï¼š`/tmp/training_videos/`
- æ¸…ç†æ—¶æœºï¼šApp å¯åŠ¨æ—¶æ¸…ç†è¿‡æœŸç¼“å­˜

**é¢„åŠ è½½ç­–ç•¥**ï¼š
```dart
// é¢„åŠ è½½å½“å‰ Â± 1 ä¸ª Feed Item çš„è§†é¢‘
void _preloadVideos(int currentIndex) {
  final feedItems = ref.read(feedItemsProvider);

  // é¢„åŠ è½½ä¸Šä¸€ä¸ª
  if (currentIndex > 0) {
    _preloadVideo(feedItems[currentIndex - 1]);
  }

  // é¢„åŠ è½½ä¸‹ä¸€ä¸ª
  if (currentIndex < feedItems.length - 1) {
    _preloadVideo(feedItems[currentIndex + 1]);
  }
}
```

### 7.2 å›¾ç‰‡ä¼˜åŒ–

**å…³é”®å¸§ç¼©ç•¥å›¾**ï¼š
- ä½¿ç”¨ `CachedNetworkImage`
- ç¼©ç•¥å›¾å°ºå¯¸ï¼š60x60pxï¼ˆKeyframe Timelineï¼‰
- å‹ç¼©è´¨é‡ï¼š70%
- ç¼“å­˜ç­–ç•¥ï¼šå†…å­˜ + ç£ç›˜åŒç¼“å­˜

**å›¾æ–‡å¡ç‰‡èƒŒæ™¯**ï¼š
- ä½¿ç”¨ CSS æ¸å˜ï¼ˆä¸åŠ è½½å›¾ç‰‡ï¼‰
- å‡å°‘å†…å­˜å ç”¨

### 7.3 Lazy Loading

**PageView æ‡’åŠ è½½**ï¼š
```dart
PageView.builder(
  itemCount: feedItems.length,
  itemBuilder: (context, index) {
    // ä»…åˆå§‹åŒ–å½“å‰ Â± 1 çš„è§†é¢‘æ’­æ”¾å™¨
    if ((index - currentIndex).abs() <= 1) {
      return _buildFeedItem(feedItems[index]);
    } else {
      return Container();  // å ä½ç¬¦
    }
  },
)
```

### 7.4 å†…å­˜ç®¡ç†

**è§†é¢‘æ’­æ”¾å™¨èµ„æºé‡Šæ”¾**ï¼š
```dart
@override
void dispose() {
  // é‡Šæ”¾æ’­æ”¾å™¨
  _controller?.dispose();

  // æ¸…ç†é¢„ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶
  if (_downloadedVideoPath != null) {
    File(_downloadedVideoPath!).deleteSync();
  }

  super.dispose();
}
```

---

## å…«ã€æµ‹è¯•ç­–ç•¥ï¼ˆTesting Strategyï¼‰

### 8.1 å•å…ƒæµ‹è¯•

**æ•°æ®æ¨¡å‹æµ‹è¯•**ï¼š
- `TrainingFeedItem` ç”Ÿæˆé€»è¾‘
- Feed Items æ’åºè§„åˆ™
- `isReviewed` çŠ¶æ€æ›´æ–°

**Repository æµ‹è¯•**ï¼š
- `generateFeedItems` æ–¹æ³•
- `markFeedItemReviewed` æ–¹æ³•
- Firestore æŸ¥è¯¢é€»è¾‘

### 8.2 Widget æµ‹è¯•

**ç»„ä»¶æµ‹è¯•**ï¼š
- `VideoFeedItem` è‡ªåŠ¨æ’­æ”¾
- `KeyframeTimeline` ä½ç½®è®¡ç®—
- `FeedCommentSheet` æ»‘åŠ¨å…³é—­
- `KeyframeFloatingButton` æ˜¾ç¤º/éšè—

### 8.3 é›†æˆæµ‹è¯•

**å®Œæ•´æµç¨‹æµ‹è¯•**ï¼š
1. è¿›å…¥é¡µé¢ â†’ Feed Items åŠ è½½æ­£ç¡®
2. ä¸Šæ»‘ â†’ æ ‡è®° `isReviewed` â†’ è¿›åº¦å¾½ç« æ›´æ–°
3. ç‚¹å‡»è¾“å…¥æ¡† â†’ è¯„è®ºåŒºæ‰“å¼€ â†’ ç•™åé¦ˆ â†’ å‘é€æˆåŠŸ
4. ç‚¹å‡»å…³é”®å¸§ç¼©ç•¥å›¾ â†’ è§†é¢‘è·³è½¬ â†’ æ‰“å¼€é¢„è§ˆé¡µ
5. ç‚¹å‡» Floating Button â†’ æ‰“å¼€å…³é”®å¸§ç®¡ç†
6. æ‰€æœ‰ Feed åˆ·å®Œ â†’ æ˜¾ç¤ºå®Œæˆé¡µ â†’ è¿”å› Coach Home

### 8.4 æ€§èƒ½æµ‹è¯•

**å…³é”®æŒ‡æ ‡**ï¼š
- Feed åˆ‡æ¢å»¶è¿Ÿï¼š< 100ms
- è§†é¢‘åŠ è½½æ—¶é—´ï¼š< 2sï¼ˆ10s è§†é¢‘ï¼‰
- å…³é”®å¸§æå–æ—¶é—´ï¼š< 500ms
- è¯„è®ºåŒºæ‰“å¼€åŠ¨ç”»ï¼š400msï¼ˆæµç•…ï¼‰

---

## ä¹ã€æœªæ¥å¢å¼ºï¼ˆFuture Enhancementsï¼‰

### 9.1 AI è¾…åŠ©åŠŸèƒ½

1. **è‡ªåŠ¨å…³é”®å¸§æå–**ï¼ˆå·²é¢„ç•™ï¼‰ï¼š
   - å¯ç”¨ `LocalKeyframeExtractor`
   - åŸºäºåŠ¨ä½œå¹…åº¦è‡ªåŠ¨è¯†åˆ«å…³é”®æ—¶åˆ»
   - æ•™ç»ƒå¯å®¡æ ¸å’Œåˆ é™¤æ— ç”¨å…³é”®å¸§

2. **AI åé¦ˆå»ºè®®**ï¼š
   - åŸºäºå†å²åé¦ˆï¼ŒAI æç¤ºå¸¸è§é—®é¢˜
   - ä¾‹å¦‚ï¼š"ä¸Šæ¬¡æåˆ°éœ€è¦æ³¨æ„ä¸‹èƒŒéƒ¨ï¼Œæœ¬æ¬¡æ˜¯å¦æ”¹å–„ï¼Ÿ"

3. **åŠ¨ä½œåˆ†æ**ï¼š
   - é›†æˆå§¿æ€ä¼°è®¡ï¼ˆPose Estimationï¼‰
   - å®æ—¶æ ‡æ³¨å…³èŠ‚è§’åº¦ã€è¿åŠ¨è½¨è¿¹

### 9.2 æ‰¹é‡æ“ä½œ

**æ‰¹é‡æ‰¹é˜…æ¨¡å¼**ï¼š
- æ•™ç»ƒå¯é€‰æ‹©"å¿«é€Ÿæ‰¹é˜…"æ¨¡å¼
- è‡ªåŠ¨è·³è¿‡å·²æ‰¹é˜…çš„ Feed Items
- ä»…æ˜¾ç¤ºå¾…æ‰¹é˜…å†…å®¹

### 9.3 å¤šæ•™ç»ƒåä½œ

**åˆ†é…æ‰¹é˜…ä»»åŠ¡**ï¼š
- ä¸»æ•™ç»ƒå¯åˆ†é…å­¦ç”Ÿç»™åŠ©ç†æ•™ç»ƒ
- åŠ©ç†æ•™ç»ƒå®Œæˆæ‰¹é˜…åï¼Œä¸»æ•™ç»ƒå®¡æ ¸

### 9.4 å­¦ç”Ÿè§†è§’

**æŸ¥çœ‹æ•™ç»ƒåé¦ˆ**ï¼š
- å­¦ç”Ÿå¯åœ¨ Training Feed ä¸­æŸ¥çœ‹æ•™ç»ƒåé¦ˆ
- ç‚¹å‡»å…³é”®å¸§æŸ¥çœ‹æ•™ç»ƒæ ‡æ³¨çš„é—®é¢˜ç‚¹

---

## åã€æŠ€æœ¯å€ºåŠ¡ä¸é£é™©ï¼ˆTechnical Debt & Risksï¼‰

### 10.1 å·²çŸ¥é™åˆ¶

1. **è§†é¢‘æ–‡ä»¶å¤§å°**ï¼š
   - å•ä¸ªè§†é¢‘ > 100MB æ—¶ï¼Œé¢„ä¸‹è½½è€—æ—¶è¾ƒé•¿
   - ç¼“è§£æ–¹æ¡ˆï¼šæç¤ºå­¦ç”Ÿå‹ç¼©è§†é¢‘æˆ–é™åˆ¶æ—¶é•¿

2. **å…³é”®å¸§æ•°é‡**ï¼š
   - å•ä¸ª Exercise è¶…è¿‡ 20 ä¸ªå…³é”®å¸§æ—¶ï¼ŒTimeline æ‹¥æŒ¤
   - ç¼“è§£æ–¹æ¡ˆï¼šæ”¯æŒæ¨ªå‘æ»šåŠ¨æˆ–åˆ†é¡µæ˜¾ç¤º

3. **ç½‘ç»œä¾èµ–**ï¼š
   - å¼±ç½‘ç¯å¢ƒä¸‹ï¼Œè§†é¢‘åŠ è½½ç¼“æ…¢
   - ç¼“è§£æ–¹æ¡ˆï¼šæ˜¾ç¤ºåŠ è½½è¿›åº¦æ¡ï¼Œæ”¯æŒç¦»çº¿ç¼“å­˜

### 10.2 æ½œåœ¨é£é™©

1. **æ•°æ®ä¸€è‡´æ€§**ï¼š
   - å¦‚æœæ•™ç»ƒåœ¨æ‰¹é˜…è¿‡ç¨‹ä¸­ï¼Œå­¦ç”Ÿæ›´æ–°äº†è®­ç»ƒè®°å½•
   - ç¼“è§£æ–¹æ¡ˆï¼šFirestore Stream å®æ—¶åŒæ­¥ï¼Œæ˜¾ç¤ºæç¤º"æ•°æ®å·²æ›´æ–°ï¼Œè¯·åˆ·æ–°"

2. **è¯¯æ“ä½œ**ï¼š
   - æ•™ç»ƒè¯¯ä¸Šæ»‘å¯¼è‡´æœªç•™åé¦ˆå°±æ ‡è®°å·²æ‰¹é˜…
   - ç¼“è§£æ–¹æ¡ˆï¼šæ”¯æŒ"æ’¤é”€"æ“ä½œï¼ˆ1 åˆ†é’Ÿå†…å¯æ’¤é”€ï¼‰

3. **å­˜å‚¨æˆæœ¬**ï¼š
   - å¤§é‡å…³é”®å¸§å›¾ç‰‡å ç”¨ Firebase Storage ç©ºé—´
   - ç¼“è§£æ–¹æ¡ˆï¼šå®šæœŸæ¸…ç†æ—§å…³é”®å¸§ï¼ˆ> 30 å¤©ï¼‰

---

## åä¸€ã€Firestore æ•°æ®ç»“æ„ç¤ºä¾‹ï¼ˆFirestore Schema Exampleï¼‰

### dailyTrainings é›†åˆ

```json
{
  "id": "dt_20231115_student123",
  "studentID": "student_123",
  "coachID": "coach_456",
  "date": "2023-11-15",
  "isReviewed": false,
  "exercises": [
    {
      "exerciseId": "ex_uuid_001",
      "name": "æ é“ƒå§æ¨",
      "sets": [
        {"reps": 8, "weight": 100, "completed": true, "rpe": 7},
        {"reps": 8, "weight": 100, "completed": true, "rpe": 7.5}
      ],
      "videos": [
        {
          "videoUrl": "https://storage.googleapis.com/...",
          "thumbnailUrl": "https://storage.googleapis.com/...",
          "isReviewed": false,
          "duration": 120
        },
        {
          "videoUrl": "https://storage.googleapis.com/...",
          "thumbnailUrl": "https://storage.googleapis.com/...",
          "isReviewed": true,
          "duration": 115
        }
      ]
    },
    {
      "exerciseId": "ex_uuid_002",
      "name": "æ·±è¹²",
      "sets": [
        {"reps": 5, "weight": 120, "completed": true, "rpe": 8},
        {"reps": 5, "weight": 120, "completed": true, "rpe": 8.5}
      ],
      "videos": []
    }
  ],
  "extractedKeyFrames": {
    "0": {
      "exerciseName": "æ é“ƒå§æ¨",
      "keyframes": [
        {
          "localPath": "/tmp/manual_keyframes/frame_001.jpg",
          "url": "https://storage.googleapis.com/...",
          "timestamp": 5.2,
          "uploadStatus": "uploaded"
        },
        {
          "localPath": "/tmp/manual_keyframes/frame_002.jpg",
          "url": "https://storage.googleapis.com/...",
          "timestamp": 12.8,
          "uploadStatus": "uploaded"
        }
      ],
      "extractedAt": "2023-11-15T10:30:00Z",
      "method": "manual"
    }
  },
  "diet": {
    "totalCalories": 2500,
    "protein": 180,
    "carbs": 300,
    "fat": 80
  },
  "createdAt": 1700041200000,
  "updatedAt": 1700041500000
}
```

### dailyTrainingFeedback é›†åˆ

```json
{
  "id": "feedback_001",
  "dailyTrainingId": "dt_20231115_student123",
  "studentId": "student_123",
  "coachId": "coach_456",
  "trainingDate": "2023-11-15",
  "exerciseId": "ex_uuid_001",
  "exerciseName": "æ é“ƒå§æ¨",
  "feedbackType": "text",
  "textContent": "åŠ¨ä½œæ•´ä½“ä¸é”™ï¼æ³¨æ„ä¸‹èƒŒéƒ¨è¦ä¿æŒè‡ªç„¶å¼§åº¦ã€‚",
  "voiceUrl": null,
  "voiceDuration": null,
  "imageUrl": null,
  "createdAt": 1700041800000,
  "isRead": false
}
```

---

## åäºŒã€å…³é”®å†³ç­–è®°å½•ï¼ˆKey Decision Logï¼‰

| å†³ç­–é¡¹ | æ–¹æ¡ˆ | åŸå›  | æ—¥æœŸ |
|--------|------|------|------|
| Feed Item ç²’åº¦ | æ¯ä¸ªè§†é¢‘ç‹¬ç«‹ä¸€ä¸ª Feed Item | æ•™ç»ƒéœ€è¦é€ä¸ªå®¡æ ¸æ¯ä¸ªè§†é¢‘ | 2025-11-17 |
| æ— è§†é¢‘ Exercise | ç”Ÿæˆå›¾æ–‡ Feed Itemï¼ˆæ±‡æ€»å¼ï¼‰ | ä¿æŒæ‰¹é˜…æµå®Œæ•´æ€§ï¼Œé¿å…é—æ¼ | 2025-11-17 |
| åé¦ˆå…³è” | è§†é¢‘é¡¹ç»‘å®š `exerciseId`ï¼Œå›¾æ–‡é¡¹ä»…ç»‘å®š `dailyTrainingId` | åŒºåˆ† Exercise çº§åˆ«å’Œè®­ç»ƒçº§åˆ«çš„åé¦ˆ | 2025-11-17 |
| è‡ªåŠ¨å…³é”®å¸§æå– | å®Œå…¨ç¦ç”¨ï¼ˆä»£ç ä¿ç•™ï¼‰ | æ‰‹åŠ¨æå–æ›´ç²¾å‡†ï¼Œå‡å°‘åå°è´Ÿæ‹… | 2025-11-17 |
| å…³é”®å¸§æ—¶é—´è½´ | é›†æˆåˆ° TikTokProgressBar | ç»Ÿä¸€äº¤äº’ä½“éªŒï¼Œå‡å°‘ç»„ä»¶å¤æ‚åº¦ | 2025-11-20 |
| è§†é¢‘å¯¹é½æ–¹å¼ | é¡¶éƒ¨å¯¹é½ï¼ˆtopCenterï¼‰ | åº•éƒ¨ç©ºé—´ç”¨äºè¿›åº¦æ¡å’Œå…³é”®å¸§æ˜¾ç¤º | 2025-11-20 |
| è¿›åº¦æ¡æ¶æ„ | èƒŒæ™¯å’Œè¿›åº¦è½¨é“ç»Ÿä¸€å¯¹é½ | é¿å…åŒçº¿é—®é¢˜ï¼Œå•ä¸€è§†è§‰è¿›åº¦æ¡ | 2025-11-20 |
| è¯„è®ºåŒºå…³é—­æ–¹å¼ | 3 ç§ï¼ˆä¸‹æ‹‰ã€ç‚¹å‡»å¤–éƒ¨ã€å–æ¶ˆæŒ‰é’®ï¼‰ | æä¾›å¤šç§é€€å‡ºè·¯å¾„ï¼Œç¬¦åˆç”¨æˆ·ä¹ æƒ¯ | 2025-11-17 |
| æ•°æ®æ¨¡å‹è°ƒæ•´ | ç§»é™¤ `planId`/`exerciseIndex`ï¼Œæ–°å¢ `exerciseId` | å…¨å±€å”¯ä¸€ ID æ›´çµæ´»ï¼Œæ”¯æŒè·¨è®¡åˆ’æŸ¥è¯¢ | 2025-11-17 |
| å†å²æ•°æ®å…¼å®¹ | ä¸è€ƒè™‘ï¼ˆcollection å·²æ¸…ç©ºï¼‰ | æ— å†å²æ•°æ®è´Ÿæ‹…ï¼Œç›´æ¥ä½¿ç”¨æ–°æ¨¡å‹ | 2025-11-17 |

---

## åä¸‰ã€å‚è€ƒæ–‡æ¡£ï¼ˆReferencesï¼‰

1. **ç°æœ‰å®ç°**ï¼š
   - [Daily Training Review Page](./daily_training_review_page_implementation.md)
   - [Manual Keyframe Extraction Feature](./manual_keyframe_extraction_feature.md)

2. **åç«¯ API**ï¼š
   - [Backend APIs and Database Schemas](../backend_apis_and_document_db_schemas.md)

3. **è®¾è®¡ç³»ç»Ÿ**ï¼š
   - [App Text Styles](../../lib/core/theme/app_text_styles.dart)
   - [App Colors](../../lib/core/theme/app_colors.dart)

4. **é¡¹ç›®è§„èŒƒ**ï¼š
   - [CLAUDE.md](../../CLAUDE.md)

---

**Document Version**: 1.2
**Last Updated**: 2025-12-02
**Author**: Claude Code
**Review Status**: Design Complete, Implementation Complete
**Recent Changes**:
- Enhanced Aggregated Card UI with diet summary section
- Added TotalNutritionCard to show calorie and macro intake progress
- Added horizontal scrolling meal images with PhotoView preview
- Added non-video exercises ListView showing exercise names and completion status
- Removed diet section from Detail Bottom Sheet (moved to Aggregated Card)
- Added target macros fetching from active diet plan
- Updated TrainingFeedItem metadata structure to include actualMacros and targetMacros
